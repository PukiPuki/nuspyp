{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer/categoryList.js"],"names":["define","categoryList","init","postContainer","postData","listEl","find","length","socket","emit","err","categories","app","alertError","message","filter","category","link","categoryMap","forEach","children","cid","parent","noPrivilege","push","Object","keys","key","sort","a","b","order","selectCategory","$","translateText","appendTo","recursive","prop","hasOwnProperty","val","text","addClass","on","changeCategory","this","parseInt","attr","trigger","removeClass","selectedCid","require","tags","updateWhitelist","level","bullet","name","child"],"mappings":"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","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer/categoryList.js","sourcesContent":["\r\n'use strict';\r\n\r\n/*globals define, socket, app*/\r\n\r\ndefine('composer/categoryList', function() {\r\n\tvar categoryList = {};\r\n\r\n\tcategoryList.init = function(postContainer, postData) {\r\n\t\tvar listEl = postContainer.find('.category-list');\r\n\t\tif (!listEl.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsocket.emit('categories.getCategoriesByPrivilege', 'topics:create', function(err, categories) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\t// Remove categories that are just external links\r\n\t\t\tcategories = categories.filter(function(category) {\r\n\t\t\t\treturn !category.link;\r\n\t\t\t});\r\n\r\n\t\t\tvar categoryMap = {};\r\n\t\t\tcategories.forEach(function(category) {\r\n\t\t\t\tcategory.children = [];\r\n\t\t\t\tcategoryMap[category.cid] = category;\r\n\t\t\t});\r\n\r\n\t\t\tcategories.forEach(function(category) {\r\n\t\t\t\tif (category.parent) {\r\n\t\t\t\t\tvar cid = category.parent.cid;\r\n\t\t\t\t\tif (!categoryMap[cid]) {\r\n\t\t\t\t\t\tcategoryMap[cid] = category.parent;\r\n\t\t\t\t\t\tcategoryMap[cid].noPrivilege = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcategoryMap[cid].children = categoryMap[cid].children || [];\r\n\t\t\t\t\tcategoryMap[cid].children.push(category);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tcategories.length = 0;\r\n\t\t\tObject.keys(categoryMap).forEach(function(key) {\r\n\t\t\t\tif (!categoryMap[key].parent) {\r\n\t\t\t\t\tcategories.push(categoryMap[key]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tcategories = categories.sort(function(a, b) {\r\n\t\t\t\treturn a.order - b.order;\r\n\t\t\t});\r\n\r\n\t\t\tvar selectCategory = $('<option value=\"0\"></option>');\r\n\t\t\tselectCategory.translateText('[[modules:composer.select_category]]').appendTo(listEl);\r\n\t\t\tcategories.forEach(function(category) {\r\n\t\t\t\trecursive(category, listEl, '');\r\n\t\t\t});\r\n\r\n\t\t\tif (postData.cid) {\r\n\t\t\t\tlistEl.find('option[value=\"' + postData.cid + '\"]').prop('selected', true);\r\n\t\t\t} else if (postData.hasOwnProperty('cid')) {\r\n\t\t\t\tpostData.cid = listEl.val();\r\n\t\t\t}\r\n\r\n\t\t\t$('.category-name').translateText(listEl.find('option[value=\"' + postData.cid + '\"]').text() || '[[modules:composer.select_category]]');\r\n\t\t\t$('.category-selector').find('li[data-cid=\"' + postData.cid + '\"]').addClass('active');\r\n\t\t});\r\n\r\n\t\tlistEl.on('change', function() {\r\n\t\t\tif (postData.hasOwnProperty('cid')) {\r\n\t\t\t\tchangeCategory(postContainer, postData, $(this).val());\r\n\t\t\t}\r\n\r\n\t\t\t$('[tabindex=' + (parseInt($(this).attr('tabindex'), 10) + 1) + ']').trigger('focus');\r\n\t\t});\r\n\r\n\t\t$('.category-selector').on('click', 'li', function() {\r\n\t\t\t$('.category-name').text($(this).text());\r\n\t\t\t$('.category-selector').removeClass('open');\r\n\t\t\t$('.category-selector li').removeClass('active');\r\n\t\t\t$(this).addClass('active');\r\n\t\t\tvar selectedCid = $(this).attr('data-cid');\r\n\t\t\t$('.category-list').val(selectedCid);\r\n\t\t\tif (postData.hasOwnProperty('cid')) {\r\n\t\t\t\tchangeCategory(postContainer, postData, selectedCid);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tfunction changeCategory(postContainer, postData, cid) {\r\n\t\tpostData.cid = cid;\r\n\t\trequire(['composer/tags'], function (tags) {\r\n\t\t\ttags.updateWhitelist(postContainer, cid);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction recursive(category, listEl, level) {\r\n\t\tif (category.link) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar bullet = level ? '&bull; ' : '';\r\n\t\t$('<option value=\"' + category.cid + '\" ' + (category.noPrivilege ? 'disabled' : '') + '>' + level + bullet + category.name + '</option>').appendTo(listEl);\r\n\r\n\t\t$('<li data-cid=\"' + category.cid + '\">' + category.name + '</li>').appendTo($('.category-selector'));\r\n\r\n\t\tcategory.children.sort(function(a, b) {\r\n\t\t\treturn a.order - b.order;\r\n\t\t}).forEach(function(child) {\r\n\t\t\trecursive(child, listEl, '&nbsp;&nbsp;&nbsp;&nbsp;' + level);\r\n\t\t});\r\n\t}\r\n\r\n\treturn categoryList;\r\n});\r\n"]}