"use strict";define("settings",function(){var e=["settings/checkbox","settings/number","settings/textarea","settings/select","settings/array","settings/key","settings/object"];var t;var n=[];var i=0;var r;function a(e,n){var i;var r;if(typeof e!=="string"){e=$(e);e=e.data("type")||e.attr("type")||e.prop("tagName")}r=t.plugins[e.toLowerCase()];if(r==null){return}i=r[n];if(typeof i==="function"){return i}return null}r={deepClone:function(e){if(typeof e==="object"){return JSON.parse(JSON.stringify(e))}return e},createElement:function(e,t,n){var i=document.createElement(e);for(var r in t){if(t.hasOwnProperty(r)){i.setAttribute(r,t[r])}}if(n){i.appendChild(document.createTextNode(n))}return i},initElement:function(e){var n=a(e,"init");if(n!=null){n.call(t,$(e))}},destructElement:function(e){var n=a(e,"destruct");if(n!=null){n.call(t,$(e))}},createElementOfType:function(e,n,i){var l;var s=a(e,"create");if(s!=null){l=$(s.call(t,e,n,i))}else{if(i==null){i={}}if(e!=null){i.type=e}l=$(r.createElement(n||"input",i))}l.data("type",e);r.initElement(l);return l},cleanArray:function(e,t,n){var i=[];if(!t&&n){return e}for(var r=0;r<e.length;r+=1){var a=e[r];if(t){if(a===!!a){a=+a}else if(a&&typeof a.trim==="function"){a=a.trim()}}if(n||a!=null&&a.length){i.push(a)}}return i},isTrue:function(e){return e==="true"||+e===1},isFalse:function(e){return e==="false"||+e===0},readValue:function(e){var n=!r.isFalse(e.data("empty"));var i=!r.isFalse(e.data("trim"));var l=e.data("split");var s=a(e,"get");var f;if(s!=null){return s.call(t,e,i,n)}if(l!=null){n=r.isTrue(e.data("empty"));f=e.val();var u=f!=null&&f.split(l||",")||[];return r.cleanArray(u,i,n)}f=e.val();if(i&&f!=null&&typeof f.trim==="function"){f=f.trim()}if(n||f!==undefined&&(f==null||f.length!==0)){return f}},fillField:function(e,n){var i=a(e,"set");var r=e.data("trim");r=r!=="false"&&+r!==0;if(i!=null){return i.call(t,e,n,r)}if(n instanceof Array){n=n.join(e.data("split")||(r?", ":","))}if(r&&n&&typeof n.trim==="function"){n=n.trim();if(typeof n.toString==="function"){n=n.toString()}}else if(n!=null){if(typeof n.toString==="function"){n=n.toString()}if(r){n=n.trim()}}else{n=""}if(n!==undefined){e.val(n)}},initFields:function(e){$("[data-key]",e).each(function(e,n){n=$(n);var i=a(n,"init");var l=n.data("key").split(".");var s=t.get();if(i!=null){i.call(t,n)}for(var f=0;f<l.length;f+=1){var u=l[f];if(u&&s!=null){s=s[u]}}r.fillField(n,s)})},registerReadyJobs:function(e){i+=e;return i},beforeReadyJobsDecreased:function(e){if(e==null){e=1}if(i>0){i-=e;if(i<=0){for(var t=0;t<n.length;t+=1){n[t]()}n=[]}}},whenReady:function(e){if(i<=0){e()}else{n.push(e)}},persistSettings:function(e,t,n,i){if(t!=null&&t._!=null&&typeof t._!=="string"){t=r.deepClone(t);t._=JSON.stringify(t._)}socket.emit("admin.settings.set",{hash:e,values:t},function(e){if(n){if(e){app.alert({title:"Settings Not Saved",type:"danger",message:"NodeBB failed to save the settings.",timeout:5e3})}else{app.alert({title:"Settings Saved",type:"success",message:"Settings have been successfully saved",timeout:2500})}}if(typeof i==="function"){i(e)}})},use:function(e){try{e._=JSON.parse(e._)}catch(e){}t.cfg=e}};t={helper:r,plugins:{},cfg:{},get:function(){if(t.cfg!=null&&t.cfg._!==undefined){return t.cfg._}return t.cfg},registerPlugin:function(e,n){if(n==null){n=e.types}else{e.types=n}if(typeof e.use==="function"){e.use.call(t)}for(var i=0;i<n.length;i+=1){var r=n[i].toLowerCase();if(t.plugins[r]==null){t.plugins[r]=e}}},set:function(e,t,n,i,a){if(a==null){a=true}r.whenReady(function(){r.use(t);r.initFields(n||"form");r.persistSettings(e,t,a,i)})},sync:function(e,t,n){socket.emit("admin.settings.get",{hash:e},function(e,i){if(e){if(typeof n==="function"){n(e)}}else{r.whenReady(function(){r.use(i);r.initFields(t||"form");if(typeof n==="function"){n()}})}})},persist:function(e,n,i,a){var l=[];var s=$("[data-key]",n||"form").toArray();if(a==null){a=true}for(var f=0;f<s.length;f+=1){var u=$(s[f]);var o=r.readValue(u);var c=t.get();var g=u.data("key").split(".");var p=g[g.length-1];if(g.length>1){for(var d=0;d<g.length-1;d+=1){var v=g[d];if(v&&c!=null){c=c[v]}}}if(c!=null){if(o!=null){c[p]=o}else{delete c[p]}}else{l.push(u.data("key"))}}if(l.length){app.alert({title:"Attributes Not Saved",message:"'"+l.join(", ")+"' could not be saved. Please contact the plugin-author!",type:"danger",timeout:5e3})}r.persistSettings(e,t.cfg,a,i)},load:function(e,t,n){n=n||function(){};socket.emit("admin.settings.get",{hash:e},function(e,i){if(e){return n(e)}for(var r in i){if(i.hasOwnProperty(r)){try{if(!utils.isNumber(i[r])){i[r]=JSON.parse(i[r])}}catch(e){}}}$(t).deserialize(i);$(t).find('input[type="checkbox"]').each(function(){$(this).parents(".mdl-switch").toggleClass("is-checked",$(this).is(":checked"))});$(window).trigger("action:admin.settingsLoaded");$(t).on("change","input, select, textarea",function(){app.flags=app.flags||{};app.flags._unsaved=true});n(null,i)})},save:function(e,t,n){t=$(t);if(t.length){var i=t.serializeObject();t.find('input[type="checkbox"]').each(function(e,t){t=$(t);if(!t.is(":checked")){i[t.attr("name")]="off"}});t.find("select[multiple]").each(function(e,t){t=$(t);i[t.attr("name")]=JSON.stringify(t.val())});socket.emit("admin.settings.set",{hash:e,values:i},function(e){app.flags._unsaved=false;if(typeof n==="function"){n(e)}else if(e){app.alert({title:"Error while saving settings",type:"error",timeout:2500})}else{app.alert({title:"Settings Saved",type:"success",timeout:2500})}})}}};r.registerReadyJobs(1);require(e,function(){for(var e=0;e<arguments.length;e+=1){t.registerPlugin(arguments[e])}r.beforeReadyJobsDecreased()});return t});
//# sourceMappingURL=public/src/modules/settings.js.map