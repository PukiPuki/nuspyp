{"version":3,"sources":["public/src/client/search.js"],"names":["define","searchModule","autocomplete","storage","Search","init","searchQuery","$","attr","val","searchIn","on","updateFormItemVisiblity","highlightMatches","off","e","preventDefault","query","getSearchData","handleSavePreferences","enableAutoComplete","fillOutForm","form","searchData","in","term","by","find","categories","searchChildren","is","hasTags","tagsinput","replies","repliesFilter","timeFilter","timeRange","sortBy","sortDirection","showAs","hide","indexOf","toggleClass","params","utils","getSearchPreferences","formData","merge","prop","Array","isArray","forEach","tag","ajaxify","data","searchDefaultSortBy","isTopic","isPost","parent","regexStr","replace","trim","split","join","regex","RegExp","each","result","this","nested","after","length","push","append","html","i","ii","addClass","setItem","JSON","stringify","app","alertSuccess","removeItem","reset","user","tagEl","confirmKeys","trimValue","siblings"],"mappings":"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","file":"public/src/client/search.js","sourcesContent":["'use strict';\n\n\ndefine('forum/search', ['search', 'autocomplete', 'storage'], function (searchModule, autocomplete, storage) {\n\tvar\tSearch = {};\n\n\tSearch.init = function () {\n\t\tvar searchQuery = $('#results').attr('data-search-query');\n\n\t\t$('#search-input').val(searchQuery);\n\n\t\tvar searchIn = $('#search-in');\n\n\t\tsearchIn.on('change', function () {\n\t\t\tupdateFormItemVisiblity(searchIn.val());\n\t\t});\n\n\t\thighlightMatches(searchQuery);\n\n\t\t$('#advanced-search').off('submit').on('submit', function (e) {\n\t\t\te.preventDefault();\n\t\t\tsearchModule.query(getSearchData(), function () {\n\t\t\t\t$('#search-input').val('');\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\n\t\thandleSavePreferences();\n\n\t\tenableAutoComplete();\n\n\t\tfillOutForm();\n\t};\n\n\tfunction getSearchData() {\n\t\tvar form = $('#advanced-search');\n\t\tvar searchData = {\n\t\t\tin: $('#search-in').val(),\n\t\t};\n\t\tsearchData.term = $('#search-input').val();\n\t\tif (searchData.in === 'posts' || searchData.in === 'titlesposts' || searchData.in === 'titles') {\n\t\t\tsearchData.by = form.find('#posted-by-user').val();\n\t\t\tsearchData.categories = form.find('#posted-in-categories').val();\n\t\t\tsearchData.searchChildren = form.find('#search-children').is(':checked');\n\t\t\tsearchData.hasTags = form.find('#has-tags').tagsinput('items');\n\t\t\tsearchData.replies = form.find('#reply-count').val();\n\t\t\tsearchData.repliesFilter = form.find('#reply-count-filter').val();\n\t\t\tsearchData.timeFilter = form.find('#post-time-filter').val();\n\t\t\tsearchData.timeRange = form.find('#post-time-range').val();\n\t\t\tsearchData.sortBy = form.find('#post-sort-by').val();\n\t\t\tsearchData.sortDirection = form.find('#post-sort-direction').val();\n\t\t\tsearchData.showAs = form.find('#show-as-topics').is(':checked') ? 'topics' : 'posts';\n\t\t}\n\n\t\treturn searchData;\n\t}\n\n\tfunction updateFormItemVisiblity(searchIn) {\n\t\tvar hide = searchIn.indexOf('posts') === -1 && searchIn.indexOf('titles') === -1;\n\t\t$('.post-search-item').toggleClass('hide', hide);\n\t}\n\n\tfunction fillOutForm() {\n\t\tvar params = utils.params();\n\t\tvar searchData = searchModule.getSearchPreferences();\n\t\tvar formData = utils.merge(searchData, params);\n\n\t\tif (formData) {\n\t\t\tif (params.term) {\n\t\t\t\t$('#search-input').val(params.term);\n\t\t\t}\n\n\t\t\tif (formData.in) {\n\t\t\t\t$('#search-in').val(formData.in);\n\t\t\t\tupdateFormItemVisiblity(formData.in);\n\t\t\t}\n\n\t\t\tif (formData.by) {\n\t\t\t\t$('#posted-by-user').val(formData.by);\n\t\t\t}\n\n\t\t\tif (formData.categories) {\n\t\t\t\t$('#posted-in-categories').val(formData.categories);\n\t\t\t}\n\n\t\t\tif (formData.searchChildren) {\n\t\t\t\t$('#search-children').prop('checked', true);\n\t\t\t}\n\n\t\t\tif (formData.hasTags) {\n\t\t\t\tformData.hasTags = Array.isArray(formData.hasTags) ? formData.hasTags : [formData.hasTags];\n\t\t\t\tformData.hasTags.forEach(function (tag) {\n\t\t\t\t\t$('#has-tags').tagsinput('add', tag);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (formData.replies) {\n\t\t\t\t$('#reply-count').val(formData.replies);\n\t\t\t\t$('#reply-count-filter').val(formData.repliesFilter);\n\t\t\t}\n\n\t\t\tif (formData.timeRange) {\n\t\t\t\t$('#post-time-range').val(formData.timeRange);\n\t\t\t\t$('#post-time-filter').val(formData.timeFilter);\n\t\t\t}\n\n\t\t\tif (formData.sortBy || ajaxify.data.searchDefaultSortBy) {\n\t\t\t\t$('#post-sort-by').val(formData.sortBy || ajaxify.data.searchDefaultSortBy);\n\t\t\t\t$('#post-sort-direction').val(formData.sortDirection);\n\t\t\t}\n\n\t\t\tif (formData.showAs) {\n\t\t\t\tvar isTopic = formData.showAs === 'topics';\n\t\t\t\tvar isPost = formData.showAs === 'posts';\n\t\t\t\t$('#show-as-topics').prop('checked', isTopic).parent().toggleClass('active', isTopic);\n\t\t\t\t$('#show-as-posts').prop('checked', isPost).parent().toggleClass('active', isPost);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction highlightMatches(searchQuery) {\n\t\tif (!searchQuery) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar regexStr = searchQuery.replace(/^\"/, '').replace(/\"$/, '').trim().split(' ').join('|');\n\t\tvar regex = new RegExp('(' + regexStr + ')', 'gi');\n\n\t\t$('.search-result-text p, .search-result-text h4').each(function () {\n\t\t\tvar result = $(this);\n\t\t\tvar nested = [];\n\n\t\t\tresult.find('*').each(function () {\n\t\t\t\t$(this).after('<!-- ' + nested.length + ' -->');\n\t\t\t\tnested.push($('<div />').append($(this)));\n\t\t\t});\n\n\t\t\tresult.html(result.html().replace(regex, '<strong>$1</strong>'));\n\n\t\t\tfor (var i = 0, ii = nested.length; i < ii; i += 1) {\n\t\t\t\tresult.html(result.html().replace('<!-- ' + i + ' -->', nested[i].html()));\n\t\t\t}\n\t\t});\n\n\t\t$('.search-result-text').find('img:not(.not-responsive)').addClass('img-responsive');\n\t}\n\n\tfunction handleSavePreferences() {\n\t\t$('#save-preferences').on('click', function () {\n\t\t\tstorage.setItem('search-preferences', JSON.stringify(getSearchData()));\n\t\t\tapp.alertSuccess('[[search:search-preferences-saved]]');\n\t\t\treturn false;\n\t\t});\n\n\t\t$('#clear-preferences').on('click', function () {\n\t\t\tstorage.removeItem('search-preferences');\n\t\t\tvar query = $('#search-input').val();\n\t\t\t$('#advanced-search')[0].reset();\n\t\t\t$('#search-input').val(query);\n\t\t\tapp.alertSuccess('[[search:search-preferences-cleared]]');\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tfunction enableAutoComplete() {\n\t\tautocomplete.user($('#posted-by-user'));\n\n\t\tvar tagEl = $('#has-tags');\n\t\ttagEl.tagsinput({\n\t\t\tconfirmKeys: [13, 44],\n\t\t\ttrimValue: true,\n\t\t});\n\n\t\tautocomplete.tag($('#has-tags').siblings('.bootstrap-tagsinput').find('input'));\n\t}\n\n\treturn Search;\n});\n"]}