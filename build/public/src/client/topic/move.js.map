{"version":3,"sources":["public/src/client/topic/move.js"],"names":["define","Move","modal","selectedEl","init","tids","currentCid","onComplete","moveAll","socket","emit","onCategoriesLoaded","err","categories","app","alertError","message","parseModal","on","remove","find","addClass","length","translateText","selectCategory","$","this","onCommitClicked","callback","templates","parse","html","require","translator","translate","forEach","category","link","buildRecursive","parentEl","level","categoryEl","bgColor","css","color","toggleClass","disabled","attr","cid","icon","name","append","indent","children","childCategory","removeClass","prop","commitEl","moveTopics","alertSuccess"],"mappings":"AAAA,aAGAA,OAAO,mBAAoB,WAC1B,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EAEJF,EAAKG,KAAO,SAAUC,EAAMC,EAAYC,GACvCN,EAAKI,KAAOA,EACZJ,EAAKK,WAAaA,EAClBL,EAAKM,WAAaA,EAClBN,EAAKO,SAAWH,EAEhBI,OAAOC,KAAK,+BAAgCC,IAG7C,SAASA,EAAmBC,EAAKC,GAChC,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3BC,EAAWJ,EAAY,WACtBX,EAAMgB,GAAG,kBAAmB,WAC3BhB,EAAMiB,WAGPjB,EAAMkB,KAAK,iBAAiBC,SAAS,QAErC,GAAIpB,EAAKO,SAAYP,EAAKI,MAAQJ,EAAKI,KAAKiB,OAAS,EAAI,CACxDpB,EAAMkB,KAAK,oBAAoBG,cAAc,yBAG9CrB,EAAMgB,GAAG,QAAS,8BAA+B,WAChDM,EAAeC,EAAEC,SAGlBxB,EAAMkB,KAAK,uBAAuBF,GAAG,QAASS,GAE9CzB,EAAMA,MAAM,UAId,SAASe,EAAWJ,EAAYe,GAC/BC,UAAUC,MAAM,8BAAgCjB,eAAkB,SAAUkB,GAC3EC,SAAS,cAAe,SAAUC,GACjCA,EAAWC,UAAUH,EAAM,SAAUA,GACpC7B,EAAQuB,EAAEM,GACVlB,EAAWsB,QAAQ,SAAUC,GAC5B,IAAKA,EAASC,KAAM,CACnBC,EAAepC,EAAMkB,KAAK,kBAAmBgB,EAAU,OAGzDR,UAMJ,SAASU,EAAeC,EAAUH,EAAUI,GAC3C,IAAIC,EAAahB,EAAE,SAEnB,GAAIW,EAASM,QAAS,CACrBD,EAAWE,IAAI,mBAAoBP,EAASM,SAE7C,GAAIN,EAASQ,MAAO,CACnBH,EAAWE,IAAI,QAASP,EAASQ,OAElCH,EAAWI,YAAY,aAAcT,EAASU,UAC9CL,EAAWM,KAAK,WAAYX,EAASY,KACrCP,EAAWM,KAAK,YAAaX,EAASa,MACtCR,EAAWM,KAAK,YAAaX,EAASc,MACtCT,EAAWV,KAAK,sBAAwBK,EAASa,KAAO,UAAYb,EAASc,MAE7EX,EAASY,OAAOX,GAChBD,EAASY,OAAOV,GAChBF,EAASY,OAAO,SAEhB,IAAIC,EAAS,uCACbhB,EAASiB,SAASlB,QAAQ,SAAUmB,GACnC,IAAKA,EAAcjB,KAAM,CACxBC,EAAeC,EAAUe,EAAeF,EAASZ,MAKpD,SAAShB,EAAeY,GACvBlC,EAAMkB,KAAK,0BAA0BW,KAAKK,EAASL,QACnD7B,EAAMkB,KAAK,iBAAiBmC,YAAY,QAExCpD,EAAaiC,EACblC,EAAMkB,KAAK,uBAAuBoC,KAAK,WAAY,OAGpD,SAAS7B,IACR,IAAI8B,EAAWvD,EAAMkB,KAAK,uBAE1B,IAAKqC,EAASD,KAAK,aAAerD,EAAW4C,KAAK,YAAa,CAC9DU,EAASD,KAAK,WAAY,MAE1BE,KAIF,SAASA,IACRjD,OAAOC,KAAKT,EAAKO,QAAU,iBAAmB,eAC7CH,KAAMJ,EAAKI,KACX2C,IAAK7C,EAAW4C,KAAK,YACrBzC,WAAYL,EAAKK,YACf,SAAUM,GACZV,EAAMA,MAAM,QAEZ,GAAIU,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3BF,IAAI6C,aAAa,+BAAiCxD,EAAW4C,KAAK,aAAe,yBAA2B5C,EAAW4C,KAAK,aAAe,UAC3I,UAAW9C,EAAKM,aAAe,WAAY,CAC1CN,EAAKM,gBAMR,OAAON","file":"public/src/client/topic/move.js","sourcesContent":["'use strict';\n\n\ndefine('forum/topic/move', function () {\n\tvar Move = {};\n\tvar modal;\n\tvar selectedEl;\n\n\tMove.init = function (tids, currentCid, onComplete) {\n\t\tMove.tids = tids;\n\t\tMove.currentCid = currentCid;\n\t\tMove.onComplete = onComplete;\n\t\tMove.moveAll = !tids;\n\n\t\tsocket.emit('categories.getMoveCategories', onCategoriesLoaded);\n\t};\n\n\tfunction onCategoriesLoaded(err, categories) {\n\t\tif (err) {\n\t\t\treturn app.alertError(err.message);\n\t\t}\n\n\t\tparseModal(categories, function () {\n\t\t\tmodal.on('hidden.bs.modal', function () {\n\t\t\t\tmodal.remove();\n\t\t\t});\n\n\t\t\tmodal.find('#move-confirm').addClass('hide');\n\n\t\t\tif (Move.moveAll || (Move.tids && Move.tids.length > 1)) {\n\t\t\t\tmodal.find('.modal-header h3').translateText('[[topic:move_topics]]');\n\t\t\t}\n\n\t\t\tmodal.on('click', '.category-list li[data-cid]', function () {\n\t\t\t\tselectCategory($(this));\n\t\t\t});\n\n\t\t\tmodal.find('#move_thread_commit').on('click', onCommitClicked);\n\n\t\t\tmodal.modal('show');\n\t\t});\n\t}\n\n\tfunction parseModal(categories, callback) {\n\t\ttemplates.parse('partials/move_thread_modal', { categories: [] }, function (html) {\n\t\t\trequire(['translator'], function (translator) {\n\t\t\t\ttranslator.translate(html, function (html) {\n\t\t\t\t\tmodal = $(html);\n\t\t\t\t\tcategories.forEach(function (category) {\n\t\t\t\t\t\tif (!category.link) {\n\t\t\t\t\t\t\tbuildRecursive(modal.find('.category-list'), category, '');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tcallback();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction buildRecursive(parentEl, category, level) {\n\t\tvar categoryEl = $('<li/>');\n\n\t\tif (category.bgColor) {\n\t\t\tcategoryEl.css('background-color', category.bgColor);\n\t\t}\n\t\tif (category.color) {\n\t\t\tcategoryEl.css('color', category.color);\n\t\t}\n\t\tcategoryEl.toggleClass('disabled', !!category.disabled);\n\t\tcategoryEl.attr('data-cid', category.cid);\n\t\tcategoryEl.attr('data-icon', category.icon);\n\t\tcategoryEl.attr('data-name', category.name);\n\t\tcategoryEl.html('<i class=\"fa fa-fw ' + category.icon + '\"></i> ' + category.name);\n\n\t\tparentEl.append(level);\n\t\tparentEl.append(categoryEl);\n\t\tparentEl.append('<br/>');\n\n\t\tvar indent = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';\n\t\tcategory.children.forEach(function (childCategory) {\n\t\t\tif (!childCategory.link) {\n\t\t\t\tbuildRecursive(parentEl, childCategory, indent + level);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction selectCategory(category) {\n\t\tmodal.find('#confirm-category-name').html(category.html());\n\t\tmodal.find('#move-confirm').removeClass('hide');\n\n\t\tselectedEl = category;\n\t\tmodal.find('#move_thread_commit').prop('disabled', false);\n\t}\n\n\tfunction onCommitClicked() {\n\t\tvar commitEl = modal.find('#move_thread_commit');\n\n\t\tif (!commitEl.prop('disabled') && selectedEl.attr('data-cid')) {\n\t\t\tcommitEl.prop('disabled', true);\n\n\t\t\tmoveTopics();\n\t\t}\n\t}\n\n\tfunction moveTopics() {\n\t\tsocket.emit(Move.moveAll ? 'topics.moveAll' : 'topics.move', {\n\t\t\ttids: Move.tids,\n\t\t\tcid: selectedEl.attr('data-cid'),\n\t\t\tcurrentCid: Move.currentCid,\n\t\t}, function (err) {\n\t\t\tmodal.modal('hide');\n\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tapp.alertSuccess('[[topic:topic_move_success, ' + selectedEl.attr('data-name') + ']] <i class=\"fa fa-fw ' + selectedEl.attr('data-icon') + '\"></i>');\n\t\t\tif (typeof Move.onComplete === 'function') {\n\t\t\t\tMove.onComplete();\n\t\t\t}\n\t\t});\n\t}\n\n\n\treturn Move;\n});\n"]}